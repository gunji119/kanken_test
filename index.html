<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>実験用｜MBTI風診断</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
     max-width:720px;margin:40px auto;padding:0 20px;line-height:1.6}
.card{border:1px solid #ddd;border-radius:14px;padding:20px;margin:20px 0}
button{padding:.6rem 1rem;border:1px solid #111;border-radius:10px;background:#fff;cursor:pointer}
h1{font-size:26px}
h2{font-size:20px;margin-top:0}
.hidden{display:none}
.choice{display:flex;flex-direction:column;gap:8px;margin-top:20px}
.scale{display:flex;justify-content:space-between;margin-top:8px}
.bar{width:100%;height:8px;background:#eee;border-radius:4px;margin-top:20px;overflow:hidden}
.bar-inner{height:100%;background:#111;width:0%}
.chart-wrap{height:360px}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{border:1px solid #ddd;padding:6px;text-align:center}
.badge{background:#111;color:#fff;font-size:12px;border-radius:8px;padding:2px 6px}
</style>
</head>
<body>
<h1>実験用｜関心×満足 MBTI風診断</h1>

<section id="quiz" class="card">
  <h2 id="qnum"></h2>
  <p id="qtext"></p>
  <div class="choice" id="choices"></div>
  <div class="bar"><div class="bar-inner" id="progress"></div></div>
</section>

<section id="result" class="card hidden">
  <h2>診断結果</h2>
  <div class="chart-wrap"><canvas id="chart"></canvas></div>
  <h3>ギャップの大きい因子</h3>
  <table class="table"><thead><tr><th>因子</th><th>関心</th><th>満足</th><th>差</th></tr></thead><tbody id="tbl"></tbody></table>
  <ul id="tips"></ul>
  <button onclick="location.reload()">もう一度</button>
</section>

<script>
const FACTORS = ["安全感","自由度","承認","挑戦","共有時間","境界線","役割の明確さ","遊び"];
const QUESTIONS = [
  {text:"人との予定が埋まっていると安心する",factor:"安全感",type:"関心"},
  {text:"誰かが自分を気にかけてくれると落ち着く",factor:"安全感",type:"満足"},
  {text:"自分のペースで進められる環境が好き",factor:"自由度",type:"関心"},
  {text:"予定やルールが厳しくても気にならない",factor:"自由度",type:"満足"},
  {text:"褒められるとやる気が出る",factor:"承認",type:"関心"},
  {text:"最近周囲から十分に評価されている",factor:"承認",type:"満足"},
  {text:"新しいことに挑戦するのが好き",factor:"挑戦",type:"関心"},
  {text:"最近わくわくすることに取り組めている",factor:"挑戦",type:"満足"},
  {text:"人と同じ時間を共有すると安心する",factor:"共有時間",type:"関心"},
  {text:"最近、信頼できる人と時間を共有できている",factor:"共有時間",type:"満足"},
  {text:"人との距離感を大事にしたい",factor:"境界線",type:"関心"},
  {text:"最近、自分の時間をしっかり守れている",factor:"境界線",type:"満足"},
  {text:"自分の役割がはっきりしていると動きやすい",factor:"役割の明確さ",type:"関心"},
  {text:"今の関係や環境で役割が曖昧だと感じる",factor:"役割の明確さ",type:"満足"},
  {text:"遊びや余白の時間がないと息が詰まる",factor:"遊び",type:"関心"},
  {text:"最近、気軽に遊ぶ時間をとれている",factor:"遊び",type:"満足"}
];
const TIPS = {
  "安全感":["予測できる予定づくり","関係性ルールを明文化"],
  "自由度":["裁量を可視化","非同期作業化"],
  "承認":["週1で成果可視化","FBフォーマット化"],
  "挑戦":["小実験を積み重ね","失敗の上限を設定"],
  "共有時間":["短い儀式を定例化","雑談テーマカード"],
  "境界線":["即レス期待を明文化","断るテンプレを共有"],
  "役割の明確さ":["RACIで範囲整理","月1棚卸し"],
  "遊び":["無目的の会","共作スプリント"]
};

// 状態
let idx=0;
let answers=[];
const quiz=document.getElementById("quiz");
const qnum=document.getElementById("qnum");
const qtext=document.getElementById("qtext");
const choices=document.getElementById("choices");
const progress=document.getElementById("progress");

const OPTIONS=["全くそう思わない","あまりそう思わない","どちらともいえない","ややそう思う","とてもそう思う"];

function showQuestion(){
  const q=QUESTIONS[idx];
  qnum.textContent=`質問 ${idx+1} / ${QUESTIONS.length}`;
  qtext.textContent=q.text;
  choices.innerHTML="";
  OPTIONS.forEach((opt,i)=>{
    const b=document.createElement("button");
    b.textContent=`${i+1}. ${opt}`;
    b.onclick=()=>answer(i+1);
    choices.appendChild(b);
  });
  progress.style.width=`${(idx/QUESTIONS.length)*100}%`;
}

function answer(val){
  answers.push(val);
  idx++;
  if(idx<QUESTIONS.length){showQuestion();}
  else{analyze();}
}

function analyze(){
  progress.style.width="100%";
  quiz.classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");
  const sums={};
  FACTORS.forEach(f=>sums[f]={関心:[],満足:[]});
  QUESTIONS.forEach((q,i)=>{
    sums[q.factor][q.type].push(answers[i]);
  });
  const interest=FACTORS.map(f=>avg(sums[f].関心));
  const satisfaction=FACTORS.map(f=>avg(sums[f].満足));

  new Chart(document.getElementById("chart"),{
    type:"radar",
    data:{labels:FACTORS,
          datasets:[
            {label:"関心",data:interest,backgroundColor:"rgba(0,0,0,.1)"},
            {label:"満足",data:satisfaction,backgroundColor:"rgba(0,0,0,.05)"}
          ]},
    options:{responsive:true,scales:{r:{min:0,max:5,ticks:{stepSize:1}}}}
  });

  const tbody=document.getElementById("tbl");
  const diffs=FACTORS.map((f,i)=>({f,interest:interest[i],satisfaction:satisfaction[i],gap:interest[i]-satisfaction[i]}))
                    .sort((a,b)=>b.gap-a.gap);
  diffs.forEach(d=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.f}</td><td>${d.interest.toFixed(1)}</td><td>${d.satisfaction.toFixed(1)}</td><td>${d.gap.toFixed(1)}</td>`;
    tbody.appendChild(tr);
  });

  const ul=document.getElementById("tips");
  ul.innerHTML="";
  diffs.filter(d=>d.interest>=4&&d.gap>=1.5).forEach(d=>{
    const li=document.createElement("li");
    li.innerHTML=`<strong>${d.f}</strong>：${(TIPS[d.f]||["提案なし"]).join("・")}`;
    ul.appendChild(li);
  });
}
function avg(arr){return arr.length?arr.reduce((a,b)=>a+b,0)/arr.length:0;}

showQuestion();
</script>
</body>
</html>
