<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>実験用｜関心度×満足度 診断</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Chart.js（CDN） -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
  :root{--fg:#111;--bd:#e5e7eb;--mut:#6b7280}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
       color:var(--fg);max-width:960px;margin:32px auto;padding:0 16px;line-height:1.65;background:#fff}
  h1{font-size:28px;margin:0 0 4px}
  h2{font-size:20px;margin:0 0 8px}
  p.muted{color:var(--mut);margin:0 0 16px}
  .card{border:1px solid var(--bd);border-radius:14px;padding:16px;margin:14px 0;background:#fff}
  .row{display:grid;grid-template-columns:1fr;gap:12px}
  .factor{border:1px solid var(--bd);border-radius:12px;padding:12px}
  .fac-head{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px}
  .sliders{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:640px){ .sliders{grid-template-columns:1fr} }
  .r{display:flex;align-items:center;gap:8px}
  input[type=range]{width:100%}
  .btn{padding:.65rem 1rem;border:1px solid #111;border-radius:12px;background:#fff;cursor:pointer}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .hidden{display:none}
  .tips li{margin-left:1rem}
  .badge{font-size:12px;color:#fff;background:#111;border-radius:999px;padding:2px 8px}
  .table{width:100%;border-collapse:collapse;margin-top:8px}
  .table th,.table td{border:1px solid var(--bd);padding:6px 8px;text-align:center}
  .chart-wrap{min-height:360px}
  .foot{margin-top:20px;font-size:12px;color:var(--mut)}
</style>
</head>
<body>
<h1>実験用</h1>
<p class="muted">因子ごとの<strong>関心度</strong>と<strong>満足度</strong>を入力 → <strong>レーダーチャート</strong>で比較 → ギャップ大の因子に提案を表示（Node不要／GitHub Pages対応）。</p>

<!-- 設定（編集しやすいよう上にまとめ） -->
<script>
  // 診断に使う因子（編集OK・順番もOK）
  const FACTORS = [
    "安全感","自由度","承認","挑戦","共有時間","境界線","役割の明確さ","遊び"
  ];

  // 因子ごとの提案サンプル（編集OK：増減してもOK）
  const TIPS = {
    "安全感":[
      "定例の場・連絡頻度を明文化して予測可能性を上げる",
      "NG/Doルールを一枚にまとめ、アクセス可能に"
    ],
    "自由度":[
      "合意済みの“裁量範囲”を書き出して共有",
      "同期作業を減らし非同期タスクへ置換"
    ],
    "承認":[
      "週1で成果の可視化（スクショ/1分デモ）",
      "『良かった点→要望→次回』の順でフィードバック"
    ],
    "挑戦":[
      "小さな実験（1週間以内で検証）を積み重ねる",
      "失敗の上限（時間/コスト）を先に決める"
    ],
    "共有時間":[
      "ショートな儀式（朝5分・週30分）を固定化",
      "雑談タイムは“テーマカード”で開始を容易に"
    ],
    "境界線":[
      "応答時間帯・連絡手段・即レス期待の明文化",
      "“断るテンプレ”を全員で持つ"
    ],
    "役割の明確さ":[
      "RACI（責任/承認/協力/通知）を簡易で運用",
      "月1で役割棚卸し・重複や過負担を調整"
    ],
    "遊び":[
      "月1“無目的の会”を設定（ルールは『否定しない』だけ）",
      "創作/ゲーム等の軽い共作をスプリントで実施"
    ]
  };

  // “関心が高い＆ギャップ大”の判定しきい値（編集OK）
  const THRESHOLDS = { interestedMin: 4, gapMin: 2 }; // 1〜5段階想定
</script>

<!-- 入力フォーム -->
<section id="form" class="card">
  <h2>1. 因子ごとの関心度×満足度を入力</h2>
  <p class="muted">各因子について、1〜5のスライダーで<strong>関心度</strong>と<strong>現在の満足度</strong>を入力してください。</p>
  <div id="factors" class="row"></div>
  <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
    <button id="analyze" class="btn">分析する</button>
    <button id="reset" class="btn" type="button">リセット</button>
  </div>
</section>

<!-- 結果 -->
<section id="result" class="card hidden">
  <h2>2. レーダーチャートとギャップ分析</h2>
  <div class="chart-wrap">
    <canvas id="chart" aria-label="因子ごとの関心度と満足度の比較レーダーチャート" role="img"></canvas>
  </div>

  <h3 style="margin-top:16px">ギャップの大きい順</h3>
  <table class="table" id="gapTable">
    <thead><tr><th>因子</th><th>関心</th><th>満足</th><th>差(関心-満足)</th></tr></thead>
    <tbody></tbody>
  </table>

  <h3 style="margin-top:16px">提案（関心高いのに満足が低い因子） <span class="badge">重点</span></h3>
  <ul class="tips" id="tipsList"></ul>

  <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
    <button class="btn" onclick="location.reload()">最初に戻る</button>
  </div>
</section>

<p class="foot">© 実験用 / すべてブラウザ内で処理。保存が必要になったらGASやSupabase連携を追加可能。</p>

<script>
  // ===== フォーム生成 =====
  const container = document.getElementById('factors');
  FACTORS.forEach((name, idx) => {
    const id = `f${idx}`;
    const el = document.createElement('div');
    el.className = 'factor';
    el.innerHTML = `
      <div class="fac-head">
        <strong>${name}</strong>
        <span class="muted">1〜5（高いほど強い）</span>
      </div>
      <div class="sliders">
        <label class="r" for="${id}-interest">
          <span style="min-width:5em">関心度</span>
          <input id="${id}-interest" type="range" min="1" max="5" step="1" value="3" />
          <output id="${id}-interest-out">3</output>
        </label>
        <label class="r" for="${id}-satisfaction">
          <span style="min-width:5em">満足度</span>
          <input id="${id}-satisfaction" type="range" min="1" max="5" step="1" value="3" />
          <output id="${id}-satisfaction-out">3</output>
        </label>
      </div>
    `;
    container.appendChild(el);
    // 出力のリアルタイム反映
    ['interest','satisfaction'].forEach(k=>{
      const inp = el.querySelector(`#${id}-${k}`);
      const out = el.querySelector(`#${id}-${k}-out`);
      inp.addEventListener('input', ()=>{ out.textContent = inp.value; });
    });
  });

  // リセット
  document.getElementById('reset').addEventListener('click', ()=>{
    FACTORS.forEach((_, idx)=>{
      const i = document.getElementById(`f${idx}-interest`);
      const s = document.getElementById(`f${idx}-satisfaction`);
      const io = document.getElementById(`f${idx}-interest-out`);
      const so = document.getElementById(`f${idx}-satisfaction-out`);
      i.value = s.value = 3; io.textContent = so.textContent = '3';
    });
  });

  // ===== 分析（レーダーチャート＋ギャップ） =====
  let chart;
  document.getElementById('analyze').addEventListener('click', () => {
    // 入力取得
    const interest = [], satisfaction = [];
    FACTORS.forEach((_, idx) => {
      const i = Number(document.getElementById(`f${idx}-interest`).value);
      const s = Number(document.getElementById(`f${idx}-satisfaction`).value);
      interest.push(i); satisfaction.push(s);
    });

    // レーダーチャート描画
    const ctx = document.getElementById('chart');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: FACTORS,
        datasets: [
          {
            label: '関心度',
            data: interest,
            fill: true,
            pointRadius: 3,
            backgroundColor: 'rgba(0,0,0,0.08)'
          },
          {
            label: '満足度',
            data: satisfaction,
            fill: true,
            pointRadius: 3,
            backgroundColor: 'rgba(0,0,0,0.03)'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top' },
          tooltip: { mode: 'nearest', intersect: false }
        },
        scales: {
          r: {
            beginAtZero: true,
            min: 0, max: 5,
            ticks: { stepSize: 1 },
            angleLines: { color: 'rgba(0,0,0,0.08)' },
            grid: { color: 'rgba(0,0,0,0.08)' },
            pointLabels: { font: { size: 11 } }
          }
        },
        elements: { line: { borderWidth: 2 } }
      }
    });

    // ギャップ計算（降順）
    const rows = FACTORS.map((name, i) => ({
      name, interest: interest[i], satisfaction: satisfaction[i], gap: (interest[i]-satisfaction[i])
    })).sort((a,b)=> b.gap - a.gap);

    // テーブル反映
    const tbody = document.querySelector('#gapTable tbody');
    tbody.innerHTML = '';
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td style="text-align:left">${r.name}</td>
                      <td>${r.interest}</td><td>${r.satisfaction}</td><td>${r.gap}</td>`;
      tbody.appendChild(tr);
    });

    // 提案（関心高い & ギャップ大）
    const tipsUL = document.getElementById('tipsList');
    tipsUL.innerHTML = '';
    rows
      .filter(r => r.interest >= THRESHOLDS.interestedMin && r.gap >= THRESHOLDS.gapMin)
      .forEach(r => {
        const li = document.createElement('li');
        const tips = TIPS[r.name] || ["（この因子の提案文を追加してください）"];
        li.innerHTML = `<strong>${r.name}</strong>：<br>${tips.map(t=>`・${t}`).join('<br>')}`;
        tipsUL.appendChild(li);
      });

    // 画面切替
    document.getElementById('form').classList.add('hidden');
    document.getElementById('result').classList.remove('hidden');

    // ▼ 解析イベント例（必要ならコメント解除）
    // window.plausible && window.plausible('Analyze', {props:{topGap: rows[0]?.name, topGapSize: rows[0]?.gap}});
    // gtag && gtag('event','analyze',{ top_gap: rows[0]?.name, top_gap_size: rows[0]?.gap });

    // ▼ 回答保存したい場合（NodeなしでGAS等にPOST）
    // fetch('YOUR_GAS_ENDPOINT_URL', {
    //   method:'POST', headers:{'Content-Type':'application/json'},
    //   body: JSON.stringify({ rows, ts:new Date().toISOString() })
    // }).catch(()=>{});
  });
</script>
</body>
</html>
